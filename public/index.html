<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot de Trading de Criptos Est√°veis - v3.4</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 0;
            padding: 32px;
            background: linear-gradient(135deg, #0d1117, #161b22);
            color: #e6edf3;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background: #1e252f;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            max-width: 960px;
            width: 100%;
            border: 1px solid #30363d;
        }

        h1 {
            font-size: 32px;
            color: #ffffff;
            text-align: center;
            margin: 0 0 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        h2 {
            font-size: 22px;
            color: #58a6ff;
            text-align: center;
            margin: 0 0 24px;
            font-weight: 500;
        }

        h3 {
            font-size: 18px;
            color: #c3d1d9;
            margin: 0 0 16px;
            font-weight: 600;
        }

        .status {
            background: #21262d;
            border: 1px solid #30363d;
            padding: 16px;
            border-radius: 12px;
            margin: 24px 0;
            color: #8b949e;
            font-size: 15px;
        }

        .status span {
            color: #2ea44f;
            font-weight: 600;
        }

        .test-section {
            background: #21262d;
            border: 1px solid #388bfd;
            padding: 20px;
            border-radius: 12px;
            margin: 24px 0;
        }

        .test-section h3 {
            color: #388bfd;
        }

        .warning {
            background: #2e1c1b;
            border: 1px solid #f85149;
            color: #ff7b72;
            padding: 16px;
            border-radius: 12px;
            margin: 24px 0;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
            align-items: center;
        }

        button {
            background: #2ea44f;
            color: #ffffff;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #3db961;
            transform: translateY(-2px);
        }

        .test-btn {
            background: #388bfd;
        }

        .test-btn:hover {
            background: #58a6ff;
        }

        #log {
            background: #161b22;
            border: 1px solid #30363d;
            padding: 16px;
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            color: #8b949e;
            line-height: 1.6;
        }

        input[type="number"] {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #30363d;
            background: #21262d;
            color: #e6edf3;
            font-size: 15px;
            width: 100%;
            box-sizing: border-box;
        }

        input[type="number"]::placeholder {
            color: #6e7681;
        }

        label {
            color: #58a6ff;
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 8px;
            display: block;
        }

        @media (max-width: 600px) {
            body {
                padding: 16px;
            }

            .container {
                padding: 24px;
            }

            h1 {
                font-size: 28px;
            }

            h2 {
                font-size: 20px;
            }

            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="container">
        <h1>üìä Bot de Trading de Criptos Est√°veis v3.4</h1>
        <h2>Monitoramento de DOGE, ETH, BTC, BNB, XRP (4H)</h2>
        <div class="warning">
            ‚ö†Ô∏è ATEN√á√ÉO: Nunca exponha seu Token de Bot do Telegram em c√≥digo que roda no navegador. Ele pode ser
            roubado! Use este script em um servidor seguro.
        </div>
        <div class="status">
            <strong>Status:</strong> <span id="status">Inicializando...</span>
        </div>
        <div class="test-section">
            <h3>üß™ Teste de Conex√£o</h3>
            <p>Teste o envio de mensagens para o Telegram:</p>
            <button class="test-btn" onclick="sendTestMessage()">üì± Enviar Teste</button>
        </div>
        <div>
            <h3>üìä Controles</h3>
            <div class="controls">
                <div>
                    <label for="entryValue">Valor de Entrada (USD):</label>
                    <input type="number" id="entryValue" min="1" placeholder="Ex.: 200" />
                </div>
                <button onclick="startBot()">‚ñ∂Ô∏è Iniciar Bot</button>
                <button onclick="stopBot()">‚èπÔ∏è Parar Bot</button>
                <button onclick="checkNow()">üîç Verificar Agora</button>
            </div>
        </div>
        <div>
            <h3>üìù Log de Atividades</h3>
            <div id="log"></div>
        </div>
    </div>
    <script>
        // Aviso de Seguran√ßa: Token exposto no c√≥digo do lado do cliente
        const telegramBotToken = "7638628732:AAHFNGTcoikDyJctbMXD1MbQlwRsR70Npn8";
        const telegramChatId = "@DogeEntradas";

        // Configura√ß√µes de Trade
        const ENTRY_PROFILE = {
            leverage: "10x",
            positionSize: "10%",
            longTP: "+4%",
            longSL: "-2%",
            shortTP: "-4%",
            shortSL: "+2%"
        };
        const DEFAULT_ENTRY_VALUE = 100;
        const ADX_MINIMO_TENDENCIA = 25;
        const checkInterval = 10 * 60 * 1000;
        const apiKlineUrl = "https://api.bybit.com/v5/market/kline";

        let botInterval = null;
        let isRunning = false;
        let lastSignalTimestamps = {};

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleString('pt-BR');
            logElement.innerHTML += `[${timestamp}] ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(status) {
            document.getElementById('status').textContent = status;
        }

        async function sendTestMessage() {
            try {
                log('Enviando mensagem de teste...');
                const now = new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' });
                const testMsg = `‚úÖ Teste do Bot de Trading v3.4\nData: ${now}`;
                await sendTelegramMessage(testMsg);
                log('‚úÖ Mensagem de teste enviada!');
            } catch (error) {
                log(`‚ùå Erro no teste: ${error.message}`);
            }
        }

        async function sendTelegramMessage(msg) {
            const response = await fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ chat_id: telegramChatId, text: msg })
            });
            if (!response.ok) throw new Error(`Erro Telegram: ${await response.text()}`);
            return response.json();
        }

        async function fetchKlineData(symbol) {
            const params = new URLSearchParams({ category: "linear", symbol, interval: "240", limit: "200" });
            try {
                const response = await fetch(`${apiKlineUrl}?${params}`);
                if (!response.ok) throw new Error(`Erro API Bybit: ${response.statusText}`);
                const json = await response.json();
                if (json.retCode !== 0) throw new Error(`Erro API: ${json.retMsg}`);
                return json.result.list.map(item => ({
                    time: Number(item[0]),
                    open: Number(item[1]),
                    high: Number(item[2]),
                    low: Number(item[3]),
                    close: Number(item[4]),
                    volume: Number(item[5])
                })).reverse();
            } catch (error) {
                log(`‚ùå Erro ao buscar dados de ${symbol}: ${error.message}`);
                return [];
            }
        }

        // Indicadores T√©cnicos
        function sma(data, period) {
            let sums = [];
            for (let i = 0; i <= data.length - period; i++) {
                let sum = 0;
                for (let j = 0; j < period; j++) sum += data[i + j];
                sums.push(sum / period);
            }
            return sums;
        }

        function ema(data, period) {
            const k = 2 / (period + 1);
            let emaData = [data[0]];
            for (let i = 1; i < data.length; i++) {
                emaData.push(data[i] * k + emaData[i - 1] * (1 - k));
            }
            return emaData;
        }

        function rsi(data, period = 14) {
            let gains = [], losses = [];
            for (let i = 1; i < data.length; i++) {
                const diff = data[i] - data[i - 1];
                gains.push(diff > 0 ? diff : 0);
                losses.push(diff < 0 ? -diff : 0);
            }
            let avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
            let avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
            let rsiValues = [100 - (100 / (1 + (avgGain / avgLoss)))];
            for (let i = period; i < gains.length; i++) {
                avgGain = (avgGain * (period - 1) + gains[i]) / period;
                avgLoss = (avgLoss * (period - 1) + losses[i]) / period;
                rsiValues.push(avgLoss === 0 ? 100 : 100 - (100 / (1 + (avgGain / avgLoss))));
            }
            return rsiValues;
        }

        function stochastic(highs, lows, closes, kPeriod, kSlowing, dPeriod) {
            let ll = [], hh = [], k = [];
            for (let i = kPeriod - 1; i < closes.length; i++) {
                ll.push(Math.min(...lows.slice(i - kPeriod + 1, i + 1)));
                hh.push(Math.max(...highs.slice(i - kPeriod + 1, i + 1)));
            }
            for (let i = 0; i < ll.length; i++) {
                k.push(100 * (closes[i + kPeriod - 1] - ll[i]) / (hh[i] - ll[i] || 1));
            }
            let smoothedK = sma(k, kSlowing);
            let d = sma(smoothedK, dPeriod);
            return { k: smoothedK, d };
        }

        function adx(highs, lows, closes, period) {
            let trs = [], plusDMs = [], minusDMs = [];
            for (let i = 1; i < highs.length; i++) {
                let tr1 = highs[i] - lows[i];
                let tr2 = Math.abs(highs[i] - closes[i - 1]);
                let tr3 = Math.abs(lows[i] - closes[i - 1]);
                trs.push(Math.max(tr1, tr2, tr3));
                let upMove = highs[i] - highs[i - 1];
                let downMove = lows[i - 1] - lows[i];
                plusDMs.push((upMove > downMove && upMove > 0) ? upMove : 0);
                minusDMs.push((downMove > upMove && downMove > 0) ? downMove : 0);
            }
            const wildersSmooth = (data) => {
                let smoothed = [data.slice(0, period).reduce((a, b) => a + b, 0) / period];
                for (let i = period; i < data.length; i++) {
                    smoothed.push((smoothed[smoothed.length - 1] * (period - 1) + data[i]) / period);
                }
                return smoothed;
            };
            let smoothedTR = wildersSmooth(trs);
            let smoothedPlusDM = wildersSmooth(plusDMs);
            let smoothedMinusDM = wildersSmooth(minusDMs);
            let plusDIs = [], minusDIs = [], dxs = [];
            for (let i = 0; i < smoothedTR.length; i++) {
                plusDIs.push(100 * (smoothedPlusDM[i] / (smoothedTR[i] || 1)));
                minusDIs.push(100 * (smoothedMinusDM[i] / (smoothedTR[i] || 1)));
            }
            for (let i = 0; i < plusDIs.length; i++) {
                dxs.push(100 * Math.abs(plusDIs[i] - minusDIs[i]) / (plusDIs[i] + minusDIs[i] || 1));
            }
            let adxValues = wildersSmooth(dxs);
            return { adx: adxValues, plusDI: plusDIs, minusDI: minusDIs };
        }

        function calculateEstimatedProfit(isShort) {
            const entryValueInput = document.getElementById('entryValue').value;
            const entryValue = (entryValueInput && Number(entryValueInput) > 0) ? Number(entryValueInput) : DEFAULT_ENTRY_VALUE;
            const leverage = 10;
            const tpPercent = isShort ? -4 : 4;
            const profit = (entryValue * leverage * Math.abs(tpPercent)) / 100;
            return { profit: profit.toFixed(2), entryValue };
        }

        async function checkSignal(symbol) {
            if (!isRunning) return;
            try {
                log(`üîç Verificando ${symbol}...`);
                const candles = await fetchKlineData(symbol);
                if (candles.length < 150) {
                    log(`‚ùå Dados insuficientes para ${symbol}.`);
                    return;
                }
                const currentCandleTimestamp = candles[candles.length - 1].time;
                if (lastSignalTimestamps[symbol] === currentCandleTimestamp) {
                    log(`‚è≥ Sinal j√° enviado para ${symbol} neste candle.`);
                    return;
                }
                const closes = candles.map(c => c.close);
                const highs = candles.map(c => c.high);
                const lows = candles.map(c => c.low);
                const ema17 = ema(closes, 17);
                const ema50 = ema(closes, 50);
                const ema72 = ema(closes, 72);
                const rsi14 = rsi(closes, 14);
                const stoch = stochastic(highs, lows, closes, 14, 5, 5);
                const adxResult = adx(highs, lows, closes, 14);
                const currentPrice = closes[closes.length - 1];
                const lastEma17 = ema17[ema17.length - 1];
                const lastEma50 = ema50[ema50.length - 1];
                const lastEma72 = ema72[ema72.length - 1];
                const lastRsi = rsi14[rsi14.length - 1];
                const lastStochK = stoch.k[stoch.k.length - 1];
                const lastAdx = adxResult.adx[adxResult.adx.length - 1];
                log(`üìä ${symbol} | Pre√ßo: ${currentPrice.toFixed(5)} | RSI: ${lastRsi.toFixed(2)} | ADX: ${lastAdx.toFixed(2)}`);
                const isLong = lastEma17 > lastEma50 && lastEma50 > lastEma72 && lastRsi > 50 && lastAdx > ADX_MINIMO_TENDENCIA && lastStochK < 80;
                const isShort = lastEma17 < lastEma50 && lastEma50 < lastEma72 && lastRsi < 50 && lastAdx > ADX_MINIMO_TENDENCIA && lastStochK > 20;
                if (isLong || isShort) {
                    const op = isShort ? "SHORT (VENDA)" : "LONG (COMPRA)";
                    const { profit, entryValue } = calculateEstimatedProfit(isShort);
                    const msg = `
üì¢ ENTRADA CONFIRMADA - ${symbol} (4H) üì¢
An√°lise: ${new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' })}
üîπ Opera√ß√£o: ${op}
üîπ Ativo: ${symbol}
üîπ Entrada: ~${currentPrice.toFixed(5)}
üîπ Valor de Entrada: $${entryValue.toFixed(2)}
üîπ Alavancagem: ${ENTRY_PROFILE.leverage}
üîπ Gerenciamento: ${ENTRY_PROFILE.positionSize}
üéØ Take Profit: ${isShort ? ENTRY_PROFILE.shortTP : ENTRY_PROFILE.longTP}
üõ°Ô∏è Stop Loss: ${isShort ? ENTRY_PROFILE.shortSL : ENTRY_PROFILE.longSL}
üí∞ Ganho Estimado: $${profit}
#TradeSignal #Bybit
                    `;
                    await sendTelegramMessage(msg);
                    log(`üöÄ Sinal ${op} enviado para ${symbol}!`);
                    lastSignalTimestamps[symbol] = currentCandleTimestamp;
                } else {
                    log(`‚è≥ Nenhuma entrada clara para ${symbol}.`);
                }
            } catch (error) {
                log(`‚ùå Erro ao verificar ${symbol}: ${error.message}`);
            }
        }

        async function checkAllSignals() {
            const assets = ['DOGEUSDT', 'ETHUSDT', 'BTCUSDT', 'BNBUSDT', 'XRPUSDT'];
            for (const asset of assets) {
                await checkSignal(asset);
            }
        }

        function startBot() {
            if (isRunning) {
                log('‚ö†Ô∏è Bot j√° est√° rodando!');
                return;
            }
            isRunning = true;
            updateStatus('üü¢ Rodando - Monitoramento ativo');
            log('‚ñ∂Ô∏è Bot iniciado! Verificando a cada 10 minutos.');
            checkAllSignals();
            botInterval = setInterval(checkAllSignals, checkInterval);
        }

        function stopBot() {
            if (!isRunning) {
                log('‚ö†Ô∏è Bot j√° est√° parado!');
                return;
            }
            isRunning = false;
            clearInterval(botInterval);
            botInterval = null;
            lastSignalTimestamps = {};
            updateStatus('üî¥ Parado');
            log('‚èπÔ∏è Bot parado! Mem√≥ria de sinais limpa.');
        }

        function checkNow() {
            if (!isRunning) {
                log('‚ö†Ô∏è Inicie o bot primeiro!');
                return;
            }
            log('For√ßando verifica√ß√£o imediata...');
            checkAllSignals();
        }

        document.addEventListener('DOMContentLoaded', () => {
            alert("AVISO DE SEGURAN√áA: Token do Telegram exposto. Use apenas em ambiente seguro!");
            updateStatus('‚úÖ Pronto para iniciar!');
            log('ü§ñ Bot v3.4 carregado e pronto!');
        });
    </script>
</body>

</html>